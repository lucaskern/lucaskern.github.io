<!DOCTYPE html>
<html>

<head>
  <!--  <link rel="stylesheet" href="css/style.css" type="text/css" />-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.11.0/d3.min.js"></script>
</head>

<body>
  <div id='graph'></div>

  <script>
    //load data file passed in. Generates error if necessary
    d3.csv("./data/quakes.csv", function(error, data) {

      if (error) {
        console.log(error);
      } else {
        //console.log(data);

        //if data loads correctly then pass it to the global var
        dataset = data;

        //DO MAGIC
        var quakesByYear = d3.nest()
          .key(function(d) {
            return d.year
          })
          .entries(dataset);

        //console.log(quakesByYear);
        console.log(quakesByYear[42]);

        var quakesByMag = d3.nest()
          .key(function(d) {
            return d.year
          })
          .key(function(d) {
            return d.mag
          })
          .entries(dataset);

        //console.log(quakesByMag);
        console.log(quakesByMag[11]);

        var quakesByQuant = d3.nest()
          .key(function(d) {
            return d.year
          })
          .key(function(d) {
            return d.mag
          })
          .rollup(function(v) {
            return v.length;
          })
          .entries(dataset);

        //console.log(quakesByMag);
        console.log(quakesByQuant[11]);

        var quakesByMagQuant = d3.nest()
          .key(function(d) {
            return d.mag
          })
          .rollup(function(v) {
            return v.length;
          })
          .entries(dataset);

        //console.log(quakesByMag);
        console.log(quakesByMagQuant[8]);

        var quakesByAvg = d3.nest()
          .key(function(d) {
            return d.year
          })
 .rollup(function(v) { return d3.mean(v, function(d) { return d.mag; }); })
          .entries(dataset);

        //console.log(quakesByMag);
        console.log(quakesByAvg[18]);

      }
    });

    //load data file passed in. Generates error if necessary
    d3.csv("./data/religions.csv", function(error, data) {

      if (error) {
        console.log(error);
      } else {
        //console.log(data);

        //if data loads correctly then pass it to the global var
        dataset = data;

        //DO MAGIC
        var religSum = d3.nest()
          .key(function(d) {
            return d.cat
          })
          .rollup(function(v) {
            return d3.sum(v, function(d) {
              return d.pop;
            });
          })
          .entries(dataset);

        //console.log(quakesByMag);
        console.log(religSum);
      }
    });
    
    //load data file passed in. Generates error if necessary
    d3.json("./data/employees.json", function(error, data) {

      if (error) {
        console.log(error);
      } else {
        //console.log(data);

        //if data loads correctly then pass it to the global var
        dataset = data;

        //DO MAGIC
        var hw = d3.nest()
          .key(function(d) {
            return d.office
          })
          .key(function(d) {
            return d.hr[0];
          })
          .rollup(function(v) { return v.length; })
          .entries(dataset);

        console.log(hw);
      }
    });

  </script>
  <a href="./hw5Tree.html"> HW5 TREE </a>
</body>

</html>
